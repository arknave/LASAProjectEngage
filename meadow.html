<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Project Engage Programming</title>
		<link type="text/css" href="stylesheets/custom-theme/jquery-ui-1.8.21.custom.css" rel="stylesheet" />
		<link href="lib/scrollbar/jquery.mCustomScrollbar.css" rel="stylesheet" type="text/css" />
		<link href="stylesheets/blocks.css" rel="stylesheet" />
		<link href="stylesheets/meadow.css" rel="stylesheet" />
		<meta name="viewport" content="height=device-height, initial-scale=1.0" />
	</head>
	<body>
		<div id="header" class="ui-widget-header">
			<span id="logo" class="title">
				Waterbear
			</span>
			<section id="toolbar" >
				<button id="about">About</button>
				<button id="restore_scripts">Restore</button>
				<button id="save_scripts">Save</button>
				<button id="demo_scripts">Demos</button>
				<button id="clear_scripts">Clear Scripts</button>
				<button id="clear_canvas">Clear Stage</button>
				<button id="run_scripts">Run</button>
			</section>
		</div>
		<div id="colmask">
			<div id="colmid">
				<div id="colright">
					<div id="col1wrap">
						<div id="col1pad">
							<div id="col1">
								<div id="scripttabs">
									<ul>
										<li><a href="#scripts_workspace">Block View</a></li>
										<li><a href="#scripts_text_view">Text View</a></li>
									</ul>
									<div id="workspace" class="workspace">
										<div id="scripts_workspace" class="scripts_workspace">
										</div>
										<div id="scripts_text_view" class="scripts_text_view">
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div id="col2">
						<div id="blocktabs">
							<ul>
								<li><a href="#accordion">Block List</a></li>
								<li><a href="#blocksearch">Block Search</a></li>
							</ul>
							<div id="accordion">
							</div>
							<div id="blocksearch">
								<input id="search" class='search-field'/>
							</div>
						</div>
					</div>
					<div id="col3">
						<!--<div id="stage" class="stage ui-content"></div>
						<div id="spritebank" class="spritebank ui-content">
							<ul id="spritelist">
								<img src="images/sprites/Archie_Che_Guevara.svg" class="sprite" />
								<img src="images/sprites/bob_marley.svg" class="sprite" />
								<img src="images/sprites/mozart.svg" class="sprite" />
								<img src="images/sprites/casifish_stallman.svg" class="sprite" />
							</ul>
						</div>
						-->
						<div id="stage" class="stage">
							<canvas>
							<p> Sorry, but your browser doesn't support canvas. Please use the latest version of Firefox </p>
							</canvas>
						</div>
						<div id="spritebank" class="ui-widget">
							<div id="spriteheader" class="ui-widget-header">
								<h4 id="spritetitle" class='title'>Sprites</h4>
								<button id="newsprite">Import Sprite</button>
							</div>
							<div id="spritecontainer" class="ui-widget-content">
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="dialog" id="about_dialog">
			<div id="about_dialog_contents">
				<p>
					<a href="index.html">Info</a>
				</p>
				<p>
					<a href="docs/index.html">Documentation</a>
				</p>
				<!-- Not sure if this is necessary, better safe than sorry -->
				<p>
					<a href="license">License</a>
				</p>
				<p>
					<a href="index.html#help">Help</a>
				</p>
			</div>
		</div>
		<div class="dialog" id="save_dialog" title="Save Script">
			<form id="save_form" class="dialogform">
				<fieldset id="save_fieldset" class="dialogfieldset">
					<h2>Save the current script</h2>
					<input id="script_name" name="script_name" class ="text ui-widget-content ui-corner-all" placeholder="Script Name" />
					<textarea id="script_description" name="script_description" class ="text ui-widget-content ui-corner-all" rows=8 placeholder="Optional Description"></textarea>
				</fieldset>
			</form>
		</div>
		<div class="dialog" id="restore_dialog">
			<div id="restore_dialog_contents">
				<h2>Restore a script</h2>
				<ul class="scrollList" id="script_list">
				</ul>
			</div>
		</div>
		<div class="dialog" id="demos_dialog">
			<div id="demos_dialog_contents">
				<h2>Load a demo</h2>
				<ul class="scrollList" id="demo_list">
				</ul>
			</div>
		</div>
		<div class="dialog" id="exp" title="Export Script">
			<h2>Exported Code</h2>
			Copy this into a text document to save for your records.
			<textarea rows=10 class="text ui-widget-content ui-corner-all"></textarea>
		</div>
		<div class="dialog" id="imp" title="Import Script">
			<h2>Import Code</h2>
			Paste the code generated by the export dialog below.
			<textarea rows=10 class="text ui-widget-content ui-corner-all"></textarea>
		</div>
		<script src="lib/jquery-1.7.2.min.js"></script>
		<!--<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>-->
		<script src="lib/jquery.ui.core.js"></script>
		<script src="lib/jquery.ui.widget.js"></script>
		<script src="lib/jquery.ui.position.js"></script>
		<script src="lib/jquery.ui.autocomplete.js"></script>
		<script src="lib/jquery.hotkeys.js"></script>
		<script src="lib/jquery.querystring.js"></script>
		<script src="lib/yepnope.1.0.2-min.js"></script>
		<script src="lib/jquery.autoGrowInput.js"></script>
		<script src="lib/json2.js"></script><!-- Make this conditional -->
		<script src="lib/jquery.scrollTo.js"></script>
		<script src="lib/jquery-ui-1.8.21.custom.min.js"></script>
		<script src="lib/scrollbar/jquery.mousewheel.min.js"></script>
		<script src="lib/scrollbar/jquery.mCustomScrollbar.js"></script>
		<script src="scripts/drag.js"></script>
		<script src="scripts/blocks.js"></script>
		<script src="scripts/runtime.js"></script>
		<!-- Should this be moved to language? -->
		<script src="scripts/workspace.js"></script>
		<script src="scripts/search.js"></script>
		<script src="scripts/keys.js"></script>
		<script>
			/*Runs the categories in the search field.*/
			$.widget("custom.catcomplete", $.ui.autocomplete, {
				_renderMenu : function(ul, items) {
					var self = this, currentCategory = "";
					$.each(items, function(index, item) {
						if (item.category != currentCategory) {
							ul.append("<li class='ui-autocomplete-category'>" + item.category + "</li>");
							currentCategory = item.category;
						}
						self._renderItem(ul, item);
					});
				}
			});
		</script>
		<script>
			var q = $.parseQuery();
			// Insert path of plugin to be loaded here
			yepnope({
				load : ["plugins/canvas.js"]
				/*callback: function(){
				 alert("canvas loaded");
				 }*/
			});
			// This needs to run after the plugin is loaded.
			function pluginReady() {
				load_current_scripts();
				if (q.demo) {
					$(document).ready(function() {
						restore_demo_by_name(q.demo);
					});
				}
				$("#accordion").accordion({
						header: "> section > h3",
						collapsible : true,
						autoHeight: false,
						active: false,
						icons : {
							"header" : "ui-icon-circle-triangle-e",
							"headerSelected" : "ui-icon-circle-triangle-s"
						}
				}).sortable({
					axis: "y",
					handle: "h3 > a",
					stop: function( event, ui ) {
						// IE doesn't register the blur when sorting
						// so trigger focusout handlers to remove .ui-state-focus
						ui.item.children( "h3" ).triggerHandler( "focusout" );
					}
				});
			}
		</script>
		<script>
			$(document).ready(function() {
				//Buttons
				$("#about").button({
					text: false,
					icons: {
						primary: "ui-icon-info"
					}					
				}).click( function() {
					$('#about_dialog').dialog("open");
				});
				$("#restore_scripts").button({
					text: false,
					icons: {
						primary: "ui-icon-folder-open"
					}					
				});
				$("#save_scripts").button({
					text: false,
					icons: {
						primary: "ui-icon-disk"
					}
				});
				$("#demo_scripts").button({
					text: false,
					icons: {
						primary: "ui-icon-notice"
					}
				});
				$("#clear_scripts").button({
					text: false,
					icons: {
						primary: "ui-icon-document"
					}
				});
				$("#clear_canvas").button({
					text: false,
					icons: {
						primary: "ui-icon-close"
					}
				});
				$("#run_scripts").button({
					text: false,
					icons: {
						primary: "ui-icon-check"
					}
				});
				$("#newsprite").button({
					text:false,
					icons: {
						primary: "ui-icon-arrowthick-1-s"
					}
				}).click( function() {
					add_sprite('Archie_Che_Guevara.svg');
				});
				
				//Tabs			
				$("#blocktabs").tabs();
				$("#scripttabs").tabs();
				/*
				$("#scripts_workspace").mCustomScrollbar({
					horizontalScroll: true,
					advanced:{
						autoExpandHorizontalScroll: true
					},
					setHeight: 50
				});*/
				//Search
				$("#search").catcomplete({
					source : window.blocknames,
				});

				//Dialogs
				$("#about_dialog").dialog({
					autoOpen: false,
					modal: true,
					resizable: false,
				});
								
				$("#save_dialog").dialog({
					autoOpen: false,
					height: 300,
					width: 450,
					modal: true,
					resizable: false,
					buttons: [
						{
							text: "Save",
							"class": 'dialogbutton',
							click: function() {
								save_named_scripts();
							}
						},
						{
							text: "Export",
							"class": 'dialogbutton',
							click: function() {
								export_named_scripts();
							}
						},
						{
							text: "Cancel",
							"class": 'dialogbutton',
							click: function() {
								$(this).dialog("close");
							}
						}
					],
					close: function(){
						$("#script_name").val("");
						$("#script_description").val("");
					}
				});
				$("#restore_dialog").dialog({
					autoOpen: false,
					height: 300,
					width: 450,
					modal: true,
					resizable: false,
					buttons: [
						{
							text: "Import",
							"class": 'dialogbutton',
							click: function() {
								$(this).dialog("close");
								$("#imp").dialog("open");
							}
						},
						{
							text: "Cancel",
							"class": 'dialogbutton',
							click: function() {
								$(this).dialog("close");
							}
						}
					],
					close: function(){
						$('#script_list').empty();
					}
				});
				$("#demos_dialog").dialog({
					autoOpen: false,
					height: 300,
					width: 450,
					modal: true,
					resizable: false,
					buttons: [
						{
							text: "Cancel",
							"class": 'dialogbutton',
							click: function() {
								$(this).dialog("close");
							}
						}
					
					],
				});
				$("#exp").dialog({
					autoOpen: false,
					height: 250,
					width: 325,
					modal: true,
					resizable: false,
					buttons: [
						{
							text: "Cancel",
							"class": 'dialogbutton',
							click: function() {
								$(this).dialog("close");
							}
						}
					
					],
				});
				$("#imp").dialog({
					autoOpen: false,
					height: 300,
					width: 325,
					modal: true,
					resizable: false,
					buttons: [
						{
							text: "Import",
							"class": 'dialogbutton',
							click: function() {
								restore_from_export();
							}
						},
						{
							text: "Cancel",
							"class": 'dialogbutton',
							click: function() {
								$(this).dialog("close");
							}
						}
					
					],
				});
			});
			var glob = new Global();
			var canvas = document.getElementsByTagName('canvas')[0];
			canvas.width = glob.stage_width;
			canvas.height = glob.stage_height;
			var ctx = canvas.getContext('2d');
			ctx.fillStyle="rgb(255,255,255)";
			ctx.fillRect(0,0,canvas.width-50,glob.stage_height);
		</script>
	</body>
</html>